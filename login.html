<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Become ‚Äî Connexion</title>

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="theme-color" content="#8B6F47">

  <link rel="icon" href="icons/logo/favicon-32.png">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

  <style>
    :root{
      --bg:#E9E5DF;
      --surface:#FFFFFF;
      --soft:#F5F2EC;
      --text:#1E1E1E;
      --muted:#6B6B6B;
      --accent:#8B6F47;
      --border:#D6CFC4;
      --radius:18px;
      --error:#C0392B;
    }

    *{box-sizing:border-box}

    body{
      margin:0;
      min-height:100vh;
      font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Arial;
      background:var(--bg);
      color:var(--text);
    }

    /* ===== HEADER ===== */
    header{
      height:56px;
      display:flex;
      align-items:center;
      padding:0 16px;
    }

    .back{
      color:var(--accent);
      font-size:14px;
      display:flex;
      align-items:center;
      gap:8px;
      cursor:pointer;
      text-decoration:none;
    }

    /* ===== MAIN ===== */
    main{
      display:flex;
      justify-content:center;
      padding:20px;
    }

    .card{
      width:100%;
      max-width:420px;
      background:var(--surface);
      border-radius:var(--radius);
      border:1px solid var(--border);
      padding:34px 26px;
      text-align:center;
    }

    .logo{
      height:44px;
      margin-bottom:18px;
    }

    h1{
      font-size:22px;
      letter-spacing:2px;
      margin:0 0 6px;
    }

    .subtitle{
      font-size:13.5px;
      color:var(--muted);
      margin-bottom:26px;
    }

    .field{
      margin-bottom:16px;
      text-align:left;
    }

    .field label{
      font-size:12.5px;
      color:var(--muted);
      display:block;
      margin-bottom:6px;
    }

    .input-wrap{
      position:relative;
    }

    .field input{
      width:100%;
      padding:13px 42px 13px 12px;
      border-radius:10px;
      background:var(--soft);
      border:1px solid var(--border);
      font-size:14px;
      color:var(--text);
    }

    .toggle-password{
      position:absolute;
      right:12px;
      top:50%;
      transform:translateY(-50%);
      color:var(--muted);
      cursor:pointer;
      font-size:14px;
    }

    .options{
      display:flex;
      align-items:center;
      gap:8px;
      font-size:12.5px;
      color:var(--muted);
      margin-bottom:18px;
    }

    .btn{
      width:100%;
      height:48px;
      border-radius:999px;
      border:none;
      font-weight:600;
      font-size:14px;
      cursor:pointer;
      margin-bottom:12px;
    }

    .primary{
      background:var(--accent);
      color:#fff;
    }

    .secondary{
      background:transparent;
      border:1px solid var(--border);
      color:var(--text);
    }

    .error{
      margin-top:12px;
      font-size:13px;
      color:var(--error);
      display:none;
    }
  </style>
</head>

<body>

<header>
  <a class="back" href="user.html">
    <i class="fa-solid fa-arrow-left"></i>
    Retour
  </a>
</header>

<main>
  <div class="card">

    <img src="icons/logo/logo.png" class="logo" alt="Become">

    <h1>Connexion</h1>
    <div class="subtitle">Acc√®de √† ton espace Become</div>

    <form id="loginForm">

      <div class="field">
        <label>Email</label>
        <input type="email" id="email" required>
      </div>

      <div class="field">
        <label>Mot de passe</label>
        <div class="input-wrap">
          <input type="password" id="password" required>
          <i class="fa-solid fa-eye toggle-password" id="togglePwd"></i>
        </div>
      </div>

      <div class="options">
        <input type="checkbox" id="remember">
        <label for="remember">Se souvenir de moi</label>
      </div>

      <button class="btn primary" type="submit">
        Se connecter
      </button>

      <button class="btn secondary" type="button"
              onclick="location.href='register.html'">
        Cr√©er un compte
      </button>

      <div class="error" id="errorMsg"></div>

    </form>
  </div>
</main>

<script type="module">
import { auth, db } from "./js/firebase.config.js";
import { signInWithEmailAndPassword } from
  "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
import { doc, getDoc } from
  "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

const form = document.getElementById("loginForm");
const errorMsg = document.getElementById("errorMsg");
const togglePwd = document.getElementById("togglePwd");
const passwordInput = document.getElementById("password");

/* üëÅÔ∏è Afficher / masquer mot de passe */
togglePwd.onclick = () => {
  const isPwd = passwordInput.type === "password";
  passwordInput.type = isPwd ? "text" : "password";
  togglePwd.className = isPwd
    ? "fa-solid fa-eye-slash toggle-password"
    : "fa-solid fa-eye toggle-password";
};

form.addEventListener("submit", async (e) => {
  e.preventDefault();
  errorMsg.style.display = "none";

  try {
    const email = email.value;
    const password = passwordInput.value;

    const { user } =
      await signInWithEmailAndPassword(auth, email, password);

    const snap = await getDoc(doc(db, "users", user.uid));
    if (!snap.exists()) throw new Error();

    location.href =
      snap.data().role === "admin"
        ? "admin.html"
        : "customer.html";

  } catch {
    errorMsg.textContent = "Email ou mot de passe incorrect";
    errorMsg.style.display = "block";
  }
  catch (error) {
  console.error("LOGIN ERROR:", error.code, error.message);
  errorMsg.textContent = error.code;
  errorMsg.style.display = "block";
}
});
</script>

</body>
</html>
