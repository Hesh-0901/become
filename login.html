<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Become ‚Äî Connexion</title>

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="theme-color" content="#0F0F0F">

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

  <style>
    :root {
      --bg:#0F0F0F;
      --surface:#1E1E1E;
      --text:#F5F5F5;
      --muted:#A0A0A0;
      --accent:#C2A16A;
      --border:#2C2C2C;
      --radius:18px;
      --error:#FF6B6B;
    }

    *{box-sizing:border-box;-webkit-tap-highlight-color:transparent}

    body{
      margin:0;
      font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Arial;
      background:linear-gradient(180deg,#0F0F0F,#161616);
      color:var(--text);
      min-height:100vh;
    }

    /* HEADER */
    .top-bar{
      height:56px;
      display:flex;
      align-items:center;
      padding:0 16px;
    }

    .back-btn{
      color:var(--muted);
      text-decoration:none;
      font-size:14px;
      display:flex;
      align-items:center;
      gap:8px;
    }

    /* CONTENT */
    .wrapper{
      display:flex;
      justify-content:center;
      padding:20px;
    }

    .card{
      width:100%;
      max-width:420px;
      background:var(--surface);
      border-radius:var(--radius);
      padding:36px 26px;
      border:1px solid var(--border);
      box-shadow:0 30px 60px rgba(0,0,0,.6);
      animation:appear .5s ease;
    }

    @keyframes appear{
      from{opacity:0;transform:translateY(20px)}
      to{opacity:1;transform:translateY(0)}
    }

    .logo{
      height:38px;
      display:block;
      margin:0 auto 14px;
    }

    .title{
      font-size:22px;
      font-weight:600;
      margin-bottom:6px;
      text-align:center;
    }

    .subtitle{
      font-size:14px;
      color:var(--muted);
      margin-bottom:26px;
      text-align:center;
    }

    .field{
      margin-bottom:16px;
    }

    .field label{
      font-size:13px;
      color:var(--muted);
      display:block;
      margin-bottom:6px;
    }

    .input-wrap{
      position:relative;
    }

    .field input{
      width:100%;
      padding:13px 40px 13px 13px;
      border-radius:10px;
      background:#161616;
      border:1px solid var(--border);
      color:var(--text);
      font-size:14px;
    }

    .toggle-password{
      position:absolute;
      right:12px;
      top:50%;
      transform:translateY(-50%);
      color:var(--muted);
      cursor:pointer;
      font-size:14px;
    }

    .remember{
      display:flex;
      align-items:center;
      gap:8px;
      font-size:13px;
      color:var(--muted);
      margin:10px 0 6px;
    }

    .remember input{
      accent-color:var(--accent);
    }

    .btn{
      width:100%;
      padding:14px;
      border-radius:999px;
      border:none;
      font-size:14px;
      font-weight:600;
      cursor:pointer;
      display:flex;
      align-items:center;
      justify-content:center;
      gap:10px;
      margin-top:10px;
    }

    .primary{
      background:var(--accent);
      color:#1B1B1B;
    }

    .secondary{
      background:transparent;
      border:1px solid var(--border);
      color:var(--text);
    }

    .error{
      margin-top:14px;
      font-size:13px;
      color:var(--error);
      display:none;
      text-align:center;
    }
  </style>
</head>

<body>

<header class="top-bar">
  <a href="user.html" class="back-btn">
    <i class="fa-solid fa-arrow-left"></i>
    Retour
  </a>
</header>

<main class="wrapper">
  <div class="card">

    <img src="icons/logo/logo.png" alt="Become" class="logo">

    <div class="title">Se connecter</div>
    <div class="subtitle">Acc√©dez √† votre espace Become</div>

    <form id="loginForm">

      <div class="field">
        <label>Email</label>
        <input type="email" id="email" required>
      </div>

      <div class="field">
        <label>Mot de passe</label>
        <div class="input-wrap">
          <input type="password" id="password" required>
          <i id="togglePwd" class="fa-solid fa-eye toggle-password"></i>
        </div>
      </div>

      <label class="remember">
        <input type="checkbox" id="remember">
        Se souvenir de moi
      </label>

      <button type="submit" class="btn primary">
        <i class="fa-solid fa-right-to-bracket"></i>
        Connexion
      </button>

      <button type="button" class="btn secondary"
        onclick="location.href='register.html'">
        Cr√©er un compte
      </button>

      <div class="error" id="errorMsg"></div>
    </form>

  </div>
</main>

<script type="module">
import { auth, db } from "./js/firebase.config.js";
import { signInWithEmailAndPassword }
  from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
import { doc, getDoc }
  from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

const form = document.getElementById("loginForm");
const errorMsg = document.getElementById("errorMsg");
const emailInput = document.getElementById("email");
const passwordInput = document.getElementById("password");
const remember = document.getElementById("remember");

/* üîÅ Restore saved email */
if (localStorage.getItem("rememberEmail")) {
  emailInput.value = localStorage.getItem("rememberEmail");
  remember.checked = true;
}

/* üëÅ Toggle password */
document.getElementById("togglePwd").onclick = () => {
  const type = passwordInput.type === "password" ? "text" : "password";
  passwordInput.type = type;
};

/* üîê Login */
form.addEventListener("submit", async e => {
  e.preventDefault();
  errorMsg.style.display = "none";

  try {
    const { user } =
      await signInWithEmailAndPassword(
        auth,
        emailInput.value,
        passwordInput.value
      );

    if (remember.checked) {
      localStorage.setItem("rememberEmail", emailInput.value);
    } else {
      localStorage.removeItem("rememberEmail");
    }

    const snap = await getDoc(doc(db,"users",user.uid));
    const role = snap.data().role;

    location.href = role === "admin"
      ? "admin.html"
      : "customer.html";

  } catch {
    errorMsg.textContent = "Email ou mot de passe incorrect";
    errorMsg.style.display = "block";
  }
});
</script>

</body>
</html>
