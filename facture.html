<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Become ‚Äî Facture</title>

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="theme-color" content="#E9E5DF">

  <!-- PDF -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

  <style>
    :root{
      --bg:#E9E5DF;
      --surface:#FFFFFF;
      --soft:#F5F2EC;
      --text:#1E1E1E;
      --muted:#6B6B6B;
      --accent:#8B6F47;
      --border:#D6CFC4;
    }

    *{box-sizing:border-box}

    body{
      margin:0;
      background:var(--bg);
      font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Arial;
      color:var(--text);
      padding:16px;
    }

    /* FACTURE */
    .invoice{
      background:var(--surface);
      border:1px solid var(--border);
      border-radius:16px;
      padding:20px;
      max-width:600px;
      margin:auto;
    }

    .header{
      display:flex;
      justify-content:space-between;
      align-items:center;
      margin-bottom:20px;
    }

    .logo{
      font-weight:700;
      letter-spacing:3px;
      color:var(--accent);
      font-size:16px;
    }

    .meta{
      font-size:12px;
      color:var(--muted);
      text-align:right;
    }

    h1{
      font-size:18px;
      margin:0 0 10px;
    }

    .section{
      margin-bottom:16px;
    }

    .section-title{
      font-size:12px;
      font-weight:600;
      letter-spacing:1px;
      margin-bottom:6px;
    }

    .box{
      background:var(--soft);
      border-radius:10px;
      padding:10px;
      font-size:13px;
    }

    .row{
      display:flex;
      justify-content:space-between;
      margin-bottom:6px;
    }

    .row:last-child{margin-bottom:0}

    .total{
      font-size:16px;
      font-weight:700;
      color:var(--accent);
    }

    .note{
      font-size:12px;
      color:var(--muted);
      line-height:1.5;
      margin-top:10px;
    }

    /* ACTIONS */
    .actions{
      max-width:600px;
      margin:16px auto 0;
      display:flex;
      gap:10px;
    }

    button{
      flex:1;
      height:46px;
      border-radius:999px;
      border:none;
      font-weight:600;
      cursor:pointer;
      font-size:14px;
    }

    .pdf{
      background:var(--accent);
      color:#fff;
    }

    .home{
      background:transparent;
      border:1px solid var(--border);
    }
  </style>
</head>

<body>

<!-- FACTURE -->
<div id="invoice" class="invoice">

  <div class="header">
    <div class="logo">BECOME</div>
    <div class="meta">
      <div id="invoiceDate">‚Äî</div>
      <div id="invoiceId">Commande ‚Äî</div>
    </div>
  </div>

  <h1>Facture</h1>

  <!-- CLIENT -->
  <div class="section">
    <div class="section-title">CLIENT</div>
    <div class="box">
      <div id="clientName">‚Äî</div>
      <div id="clientPhone">‚Äî</div>
      <div id="clientAddress">‚Äî</div>
    </div>
  </div>

  <!-- ARTICLES -->
  <div class="section">
    <div class="section-title">ARTICLES</div>
    <div class="box" id="items"></div>
  </div>

  <!-- TOTAL -->
  <div class="section">
    <div class="box">
      <div class="row total">
        <span>Total</span>
        <span id="total">‚Äî</span>
      </div>
    </div>
  </div>

  <!-- NOTE -->
  <div class="note">
    Merci pour votre commande üôè  
    Vous pouvez suivre l‚Äôavancement de celle-ci depuis l‚Äôapplication.  
    Merci de proc√©der au paiement afin d‚Äôacc√©l√©rer le traitement.
  </div>

</div>

<!-- ACTIONS -->
<div class="actions">
  <button class="home" onclick="location.href='index.html'">
    Retour boutique
  </button>
  <button class="pdf" id="pdfBtn">
    T√©l√©charger PDF
  </button>
</div>

<script>
/* ===== R√âCUP COMMANDE (exemple simple) ===== */
/* Tu pourras remplacer √ßa par Firestore plus tard */

const order = JSON.parse(localStorage.getItem("lastOrder") || "{}");

/* FALLBACK DEMO */
const demo = {
  id: "BC-001",
  createdAt: new Date(),
  customer: {
    name: "Client Become",
    phone: "+243‚Ä¶",
    address: "Lubumbashi"
  },
  items: [
    { title:"Produit A", qty:1, price:25000 },
    { title:"Produit B", qty:2, price:12000 }
  ]
};

const data = order.items ? order : demo;

/* ===== RENDER ===== */
document.getElementById("invoiceDate").textContent =
  new Date(data.createdAt || Date.now()).toLocaleString();

document.getElementById("invoiceId").textContent =
  `Commande ${data.id || "‚Äî"}`;

document.getElementById("clientName").textContent = data.customer.name;
document.getElementById("clientPhone").textContent = data.customer.phone;
document.getElementById("clientAddress").textContent = data.customer.address || "";

let total = 0;
const itemsEl = document.getElementById("items");

data.items.forEach(p=>{
  total += p.price * p.qty;
  itemsEl.innerHTML += `
    <div class="row">
      <span>${p.title} √ó ${p.qty}</span>
      <span>${(p.price*p.qty).toLocaleString()} CDF</span>
    </div>
  `;
});

document.getElementById("total").textContent =
  `${total.toLocaleString()} CDF`;

/* ===== PDF ===== */
document.getElementById("pdfBtn").onclick = () => {
  html2pdf()
    .from(document.getElementById("invoice"))
    .set({
      margin: 10,
      filename: `facture-${data.id || "become"}.pdf`,
      html2canvas: { scale: 2 },
      jsPDF: { unit: "mm", format: "a4", orientation: "portrait" }
    })
    .save();
};
</script>

</body>
</html>
