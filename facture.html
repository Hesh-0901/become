<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Become ‚Äî Facture</title>

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="theme-color" content="#E9E5DF">

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

  <style>
    :root{
      --bg:#E9E5DF;
      --surface:#FFFFFF;
      --soft:#F5F2EC;
      --text:#1E1E1E;
      --muted:#6B6B6B;
      --accent:#8B6F47;
      --border:#D6CFC4;
      --radius:16px;
    }

    *{box-sizing:border-box}

    body{
      margin:0;
      font-family:system-ui,-apple-system,BlinkMacSystemFont;
      background:var(--bg);
      color:var(--text);
      padding:16px;
    }

    .invoice{
      max-width:700px;
      margin:auto;
      background:var(--surface);
      border-radius:var(--radius);
      border:1px solid var(--border);
      padding:22px;
    }

    /* HEADER */
    .header{
      display:flex;
      justify-content:space-between;
      align-items:center;
      margin-bottom:20px;
    }

    .logo{
      height:28px;
    }

    .badge{
      background:var(--soft);
      border-radius:999px;
      padding:6px 12px;
      font-size:12px;
      font-weight:600;
      color:var(--accent);
    }

    h1{
      font-size:18px;
      margin:16px 0 6px;
      letter-spacing:2px;
    }

    .muted{
      color:var(--muted);
      font-size:12px;
    }

    /* SECTIONS */
    .section{
      margin-top:18px;
      padding-top:14px;
      border-top:1px solid var(--border);
    }

    .row{
      display:flex;
      justify-content:space-between;
      font-size:13px;
      margin-bottom:6px;
    }

    /* ITEMS */
    .item{
      display:flex;
      justify-content:space-between;
      font-size:13px;
      margin-bottom:6px;
    }

    .total{
      font-size:16px;
      font-weight:700;
      margin-top:10px;
    }

    /* MESSAGE */
    .notice{
      margin-top:18px;
      background:var(--soft);
      padding:14px;
      border-radius:12px;
      font-size:13px;
      line-height:1.6;
    }

    /* ACTIONS */
    .actions{
      margin-top:20px;
      display:flex;
      gap:10px;
    }

    .btn{
      flex:1;
      height:44px;
      border-radius:999px;
      border:none;
      font-size:14px;
      font-weight:600;
      cursor:pointer;
    }

    .primary{
      background:var(--accent);
      color:#fff;
    }

    .secondary{
      background:transparent;
      border:1px solid var(--border);
    }

    @media print{
      body{background:#fff;padding:0}
      .actions{display:none}
      .invoice{border:none}
    }
  </style>
</head>

<body>

<div class="invoice" id="invoice">

  <!-- HEADER -->
  <div class="header">
    <img src="icons/logo/logo.png" alt="Become" class="logo">
    <div class="badge" id="orderNumber">‚Äî</div>
  </div>

  <h1>FACTURE</h1>
  <div class="muted" id="date">‚Äî</div>

  <!-- CLIENT -->
  <div class="section">
    <div class="row"><strong>Client</strong></div>
    <div class="row"><span id="clientName">‚Äî</span></div>
    <div class="row"><span id="clientPhone">‚Äî</span></div>
    <div class="row muted" id="clientAddress">‚Äî</div>
  </div>

  <!-- ITEMS -->
  <div class="section">
    <div class="row"><strong>Articles</strong></div>
    <div id="items"></div>
    <div class="row total" id="total">‚Äî</div>
  </div>

  <!-- STATUS -->
  <div class="section">
    <div class="row">
      <span>Statut</span>
      <strong id="status">‚Äî</strong>
    </div>
  </div>

  <!-- MESSAGE -->
  <div class="notice">
    Merci pour votre commande chez <strong>BECOME</strong> ü§ç<br><br>
    Cette commande est en attente de paiement.<br>
    Veuillez proc√©der au paiement via <strong>Mobile Money</strong> ou
    nous contacter sur <strong>WhatsApp</strong> pour finaliser.<br><br>
    Vous pourrez suivre l‚Äô√©volution de votre commande directement
    dans votre espace client.
  </div>

  <!-- ACTIONS -->
  <div class="actions">
    <button class="btn secondary" onclick="location.href='user.html'">
      Retour
    </button>
    <button class="btn primary" onclick="window.print()">
      T√©l√©charger PDF
    </button>
  </div>

</div>

<script type="module">
import { auth, db } from "./js/firebase.config.js";
import { onAuthStateChanged } from
  "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
import { doc, getDoc } from
  "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

/* ===== PARAM ===== */
const params = new URLSearchParams(location.search);
const orderId = params.get("orderId");
if(!orderId) location.href="index.html";

/* ===== AUTH ===== */
onAuthStateChanged(auth, async user=>{
  if(!user){
    location.href="login.html";
    return;
  }

  const snap = await getDoc(doc(db,"orders",orderId));
  if(!snap.exists()){
    alert("Facture introuvable");
    location.href="index.html";
    return;
  }

  const o = snap.data();

  document.getElementById("orderNumber").textContent = o.orderNumber;
  document.getElementById("date").textContent =
    new Date(o.createdAt.seconds*1000).toLocaleString();

  document.getElementById("clientName").textContent = o.customer.name;
  document.getElementById("clientPhone").textContent = o.customer.phone;
  document.getElementById("clientAddress").textContent =
    o.customer.address || "";

  const itemsEl = document.getElementById("items");
  let total = 0;

  o.items.forEach(p=>{
    total += p.price * p.qty;
    itemsEl.innerHTML += `
      <div class="item">
        <span>${p.title} √ó ${p.qty}</span>
        <span>${(p.price*p.qty).toLocaleString()} CDF</span>
      </div>
    `;
  });

  document.getElementById("total").textContent =
    `Total : ${total.toLocaleString()} CDF`;

  document.getElementById("status").textContent =
    o.status === "pending" ? "En attente de paiement" : o.status;
});
</script>

</body>
</html>