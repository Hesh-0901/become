<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Become ‚Äî Boutique premium</title>

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

  <!-- PWA -->
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#8B6F47">

  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

  <style>
    :root {
      --color-bg: #F4F1ED;
      --color-surface: #FFFFFF;
      --color-text: #1C1C1C;
      --color-muted: #6B6B6B;
      --color-accent: #8B6F47;
      --color-border: #E6E6E6;
      --radius-sm: 8px;
    }

    * {
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }

    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Arial, sans-serif;
      background: var(--color-bg);
      color: var(--color-text);
    }

    /* Splash */
    #splash {
      position: fixed;
      inset: 0;
      background: var(--color-bg);
      z-index: 9999;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .splash-content {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 18px;
    }

    .splash-logo {
      width: 72px;
    }

    .loader {
      width: 26px;
      height: 26px;
      border: 2px solid var(--color-border);
      border-top-color: var(--color-accent);
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* Header */
    .app-header {
      position: sticky;
      top: 0;
      background: var(--color-bg);
      border-bottom: 1px solid var(--color-border);
      z-index: 10;
    }

    .app-header__bar {
      height: 52px;
      padding: 0 12px;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .app-header__brand {
      font-size: 15px;
      font-weight: 600;
      letter-spacing: 3px;
    }

    .app-header__actions {
      display: flex;
      gap: 14px;
    }

    .app-header__action {
      font-size: 15px;
      color: var(--color-muted);
      cursor: pointer;
    }

    /* Grid */
    .product-grid {
      padding: 10px;
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 10px;
    }

    .product-card {
      background: var(--color-surface);
      border: 1px solid var(--color-border);
      border-radius: var(--radius-sm);
      overflow: hidden;
    }

    .product-card__image {
      width: 100%;
      aspect-ratio: 3 / 4;
      object-fit: cover;
    }

    .product-card__body {
      padding: 8px;
      background: #F8F6F3;
    }

    .product-card__title {
      font-size: 12px;
      font-weight: 500;
      margin: 0;
    }

    .product-card__price {
      margin-top: 4px;
      font-size: 12px;
      font-weight: 600;
      color: var(--color-accent);
    }

    @media (min-width: 768px) {
      .product-grid {
        grid-template-columns: repeat(4, 1fr);
        max-width: 1200px;
        margin: auto;
      }
    }
  </style>
</head>

<body>

<!-- Splash -->
<div id="splash">
  <div class="splash-content">
    <img src="./icons/icon.192.png" class="splash-logo">
    <div class="loader"></div>
  </div>
</div>

<!-- Header -->
<header class="app-header">
  <div class="app-header__bar">
    <div class="app-header__brand">BECOME</div>
    <div class="app-header__actions">
      <i class="fa-solid fa-magnifying-glass app-header__action"></i>
      <i class="fa-solid fa-cart-shopping app-header__action"></i>
      <i id="userBtn" class="fa-solid fa-user app-header__action"></i>
    </div>
  </div>
</header>

<!-- Products -->
<main class="product-grid">

<script>
  const products = [
    ["T-shirt Essential",29,"1521572163474-6864f9cf17ab"],
    ["Sweat Premium",59,"1618354691373-d851c5c3a990"],
    ["Pantalon Tailored",69,"1593032465171-8c6e4b5b0f5c"],
    ["Veste Signature",119,"1542060748-10c28b62716e"],
    ["Hoodie Urban",75,"1602810318383-e386cc2a3ccf"],
    ["Chemise Classique",49,"1520975918318-7da08c5cfd7c"],
    ["Blazer Moderne",139,"1520975918318-7da08c5cfd7c"],
    ["Jean Slim",59,"1512436991641-6745cdb1723f"],
    ["Pull Minimal",65,"1618354691373-d851c5c3a990"],
    ["Manteau Long",159,"1541099649105-f69ad21f3246"],
    ["Polo Premium",39,"1583743814966-8936f37f4671"],
    ["Short Casual",35,"1562158070-622a2a7f0d4d"],
    ["Veste Denim",89,"1551024601-bec78aea704b"],
    ["Cardigan",55,"1593032465171-8c6e4b5b0f5c"],
    ["Pantalon Cargo",79,"1594938298603-c8148c4dae35"],
    ["Sweat Zipp√©",69,"1618354691373-d851c5c3a990"],
    ["T-shirt Oversize",34,"1521572163474-6864f9cf17ab"],
    ["Chemise Lin",59,"1520975918318-7da08c5cfd7c"],
    ["Veste Cuir",199,"1542060748-10c28b62716e"],
    ["Pull Col Roul√©",75,"1602810318383-e386cc2a3ccf"],
    ["Jean Brut",69,"1512436991641-6745cdb1723f"],
    ["Sweat Basic",49,"1618354691373-d851c5c3a990"],
    ["Pantalon Classique",79,"1593032465171-8c6e4b5b0f5c"],
    ["Veste L√©g√®re",99,"1542060748-10c28b62716e"],
    ["Hoodie Premium",85,"1602810318383-e386cc2a3ccf"],
    ["T-shirt Coton Bio",32,"1521572163474-6864f9cf17ab"],
    ["Chemise Oversize",55,"1520975918318-7da08c5cfd7c"],
    ["Blouson Urbain",129,"1542060748-10c28b62716e"],
    ["Pull Laine",89,"1602810318383-e386cc2a3ccf"],
    ["Veste Tailoring",149,"1542060748-10c28b62716e"]
  ];

  document.write(products.map(p => `
    <article class="product-card">
      <img class="product-card__image"
        src="https://images.unsplash.com/photo-${p[2]}?auto=format&fit=crop&w=600&q=80">
      <div class="product-card__body">
        <h3 class="product-card__title">${p[0]}</h3>
        <div class="product-card__price">${p[1]} ‚Ç¨</div>
      </div>
    </article>
  `).join(""));
</script>

</main>

<!-- Firebase redirect logic -->
<script type="module">
  import { auth, db } from "./js/firebase.config.js";
  import { onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
  import { doc, getDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

  const userBtn = document.getElementById("userBtn");

  userBtn.addEventListener("click", async () => {
    const user = auth.currentUser;

    // ‚ùå Pas connect√© ‚Üí page user
    if (!user) {
      window.location.href = "user.html";
      return;
    }

    // üì¶ R√©cup√©rer le r√¥le
    const snap = await getDoc(doc(db, "users", user.uid));

    if (!snap.exists()) {
      window.location.href = "user.html";
      return;
    }

    const role = snap.data().role;

    // üîÅ Redirection selon r√¥le
    if (role === "admin") {
      window.location.href = "admin.html";
    } else {
      window.location.href = "customer.html";
    }
  });
</script>

<script>
  if ("serviceWorker" in navigator) {
    navigator.serviceWorker.register("/service-worker.js");
  }

  window.addEventListener("load", () => {
    const splash = document.getElementById("splash");
    splash.style.opacity = "0";
    setTimeout(() => splash.remove(), 300);
  });
</script>

</body>
</html>
