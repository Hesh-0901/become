<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Become — Inscription</title>

    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="theme-color" content="#E9E5DF">

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

  <style>
    :root{
      --bg:#E9E5DF;
      --surface:#FFFFFF;
      --soft:#FFF0DF;
      --text:#1E1E1E;
      --muted:#6B6B6B;
      --accent:#8B6F47;
      --border:#D6CFC4;
      --radius:18px;
      --error:#C0392B;
    }

    *{box-sizing:border-box}

    body{
      margin:0;
      min-height:100vh;
      background:var(--bg);
      font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Arial;
      color:var(--text);
    }

    header{
      height:56px;
      display:flex;
      align-items:center;
      padding:0 16px;
    }

    header a{
      color:var(--accent);
      text-decoration:none;
      font-size:14px;
      display:flex;
      align-items:center;
      gap:8px;
    }

    main{
      display:flex;
      justify-content:center;
      padding:20px;
    }

    .card{
      width:100%;
      max-width:420px;
      background:var(--surface);
      border:1px solid var(--border);
      border-radius:var(--radius);
      padding:28px;
    }

    .brand{
      text-align:center;
      font-weight:600;
      letter-spacing:4px;
      color:var(--accent);
      margin-bottom:16px;
    }

    h1{
      font-size:20px;
      margin:0 0 6px;
    }

    p{
      font-size:13px;
      color:var(--muted);
      margin-bottom:22px;
    }

    .field{margin-bottom:12px}

    label{
      font-size:12px;
      color:var(--muted);
      display:block;
      margin-bottom:4px;
    }

    input, select{
      width:100%;
      height:38px;
      border-radius:10px;
      border:1px solid var(--border);
      padding:0 12px;
      background:var(--soft);
      font-size:13px;
    }

    .password{
      position:relative;
    }

    .password button{
      position:absolute;
      right:8px;
      top:50%;
      transform:translateY(-50%);
      background:none;
      border:none;
      color:var(--muted);
      cursor:pointer;
    }

    .checkbox{
      display:flex;
      gap:8px;
      font-size:12px;
      color:var(--muted);
      margin:14px 0;
    }

    .btn{
      width:100%;
      height:46px;
      border-radius:999px;
      border:none;
      background:var(--accent);
      color:#fff;
      font-weight:600;
      cursor:pointer;
    }

    .error{
      color:var(--error);
      font-size:12px;
      margin-bottom:10px;
      display:none;
    }
  </style>
</head>

<body>

<header>
  <a href="user.html"><i class="fa-solid fa-arrow-left"></i> Retour</a>
</header>

<main>
  <form class="card" id="registerForm">

    <div class="brand">BECOME</div>

    <h1>Créer un compte</h1>
    <p>Une inscription simple, sécurisée et premium.</p>

    <div class="field"><label>Prénom</label><input id="firstName" required></div>
    <div class="field"><label>Nom</label><input id="lastName" required></div>

    <div class="field">
      <label>Genre</label>
      <select id="gender" required>
        <option value="">Choisir</option>
        <option>Homme</option>
        <option>Femme</option>
      </select>
    </div>

    <div class="field"><label>Téléphone</label><input id="phone" required></div>
    <div class="field"><label>Email</label><input id="email" type="email" required></div>

    <div class="field password">
      <label>Mot de passe</label>
      <input id="password" type="password" autocomplete="new-password" required>
      <button type="button" onclick="toggle('password',this)">
        <i class="fa-solid fa-eye"></i>
      </button>
    </div>

    <div class="field password">
      <label>Confirmer</label>
      <input id="passwordConfirm" type="password" autocomplete="new-password" required>
      <button type="button" onclick="toggle('passwordConfirm',this)">
        <i class="fa-solid fa-eye"></i>
      </button>
    </div>

    <div class="field"><label>Ville</label><input id="city" required></div>
    <div class="field"><label>Quartier</label><input id="district" required></div>

    <div class="checkbox">
      <input type="checkbox" id="terms" required>
      <label for="terms">J’accepte les conditions d’utilisation</label>
    </div>

    <div id="errorMsg" class="error"></div>

    <button class="btn">Créer mon compte</button>
  </form>
</main>

<script>
function toggle(id,btn){
  const i=document.getElementById(id);
  const icon=btn.querySelector("i");
  i.type=i.type==="password"?"text":"password";
  icon.classList.toggle("fa-eye");
  icon.classList.toggle("fa-eye-slash");
}
</script>

<script type="module">
import { auth, db } from "./js/firebase.config.js";
import { createUserWithEmailAndPassword } from
  "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
import { doc, setDoc, serverTimestamp } from
  "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

const form=document.getElementById("registerForm");
const errorMsg=document.getElementById("errorMsg");

form.addEventListener("submit", async e=>{
  e.preventDefault();
  errorMsg.style.display="none";

  if(password.value !== passwordConfirm.value){
    return show("Les mots de passe ne correspondent pas");
  }

  try{
    const cred = await createUserWithEmailAndPassword(
      auth,
      email.value.trim(),
      password.value
    );

    await setDoc(doc(db,"users",cred.user.uid),{
      uid: cred.user.uid,
      email: cred.user.email,
      firstName: firstName.value,
      lastName: lastName.value,
      gender: gender.value,
      phone: phone.value,
      city: city.value,
      district: district.value,
      role: "customer",
      createdAt: serverTimestamp()
    });

    location.href="customer.html";

  }catch(e){
    console.error(e.code, e.message);
    show(e.code);
  }
});

function show(t){
  errorMsg.textContent=t;
  errorMsg.style.display="block";
}
</script>

</body>
</html>
